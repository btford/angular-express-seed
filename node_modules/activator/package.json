{
  "name": "activator",
  "description": "simple user activation and password reset for nodejs",
  "version": "0.2.5",
  "url": "http://github.com/deitch/activator",
  "author": {
    "name": "Avi Deitcher",
    "email": "avi@deitcher.net"
  },
  "engines": [
    "node >= 0.8"
  ],
  "main": "./lib/activator.js",
  "dependencies": {
    "lodash": ">=1.3.1",
    "async": "0.2.x",
    "nodemailer": "~0.5.2"
  },
  "devDependencies": {
    "express": "3.x",
    "mocha": "1.x",
    "supertest": "0.x",
    "smtp-tester": "~0.4.8",
    "should": "~1.2.2"
  },
  "keywords": [
    "express",
    "email",
    "sms",
    "activation",
    "nodejs",
    "node",
    "confirmation",
    "two-step"
  ],
  "scripts": {
    "test": "node_modules/.bin/mocha"
  },
  "repository": {
    "type": "git",
    "url": "http://github.com/deitch/activator.git"
  },
  "readme": "# Activator\n\n## Overview\nactivator is the **simple** way to handle user activation and password reset for your nodejs apps!\n\nExample:\n    \n    var express = require('express'), app = express(), activator = require('activator');\n\t\t\n\t\tactivator.init({user:userModel,url:URL,templates:mailTemplatesDir});\n\t\t\n\t\tapp.user(app.router);\n\t\t\n\t\t// activate a user\n\t\tapp.post(\"/user\",activator.createActivate);\n\t\tapp.put(\"/user/:user/active\",activator.completeActivate);\n\t\t\n\t\t// reset a password\n\t\tapp.post(\"/passwordreset\",activator.createPasswordReset);\n\t\tapp.put(\"/passwordreset/:user\",activator.completePasswordReset);\n\n\n\n## Installation\nInstallation is simple, just install the npm module:\n\n    npm install activator\n\n\n## Usage\nFirst *initialize* your activator instance, then use its methods to activate users and reset passwords\n\n### Initialization\nIn order for activator to work, it needs to be able to read your user instances and save to them. It also needs to be able to compose and send emails.\n\n    activator = require('activator');\n\t\tactivator.init(config);\n\nThe `config` object passed to `activator.init()` **must** contain the following keys:\n\n* `user`: object that allows activator to find and save a user object. See below.\n* `emailProperty`: the property of the returned user object that is the email of the recipient. Used in `user.find()`. Defaults to \"email\".\n* `url`: string that describes how we will send email. See below.\n* `templates`: string describing the full path to the mail templates. See below.\n\n\n##### user\nThe user object needs to have two methods, with the following signatures:\n\n    user.find(login,callback);\n\t\t\nWhere:\n\n* `login`: string with which the user logs in. activator doesn't care if it is an email address, a user ID, or the colour of their parrot. `user.find()` should be able to find a user based on it.\n* `callback`: the callback function that `user.find()` should call when complete. Has the signature `callback(err,data)`. If there is an error, `data` should be `null` or `undefined`; if there is no error but no users found, both `err` *and* `data` **must** be `null` (not `undefined`). If an object is found, then `data` **must** be a single JavaScript object, and the object **must** have a property containing the email address. By default, it is named `email`, but you can override it with `config.emailProperty`.\n\nactivator also needs to be able to save a user:\n\n    user.save(id,data,callback);\n\nWhere:\n\n* `id`: ID of the user to save\n* `data`: the data to update the user as an object, e.g.: `{activation_code: \"asqefcehe78qa\"}`\n* `callback`: the callback function that `user.save()` should call when complete. Has the signature `callback(err)`. If the save is successful, `err` **must** be `null` (not `undefined`).\n\nWhat properties will it add to the user object in `save()`?\n\n1. activation: When a new activation is created, it will save a random string to `activation_code`. For example: `user.save(\"256\",{activation_code:\"ABT678HB\"})`. When activation is complete, it will set the code to \"X\".\n2. password reset: When a new password reset is created, it will save a random string to `password_reset_code` and an integer representing the expiry at `password_reset_time`. For examle, `user.save(\"256\",{password_reset_code:\"ABT678YY\",password_reset_time:1377151862978})`. When password reset is complete, it will set the code to \"X\" and the time to 0.\n\n##### url\nURL string of how activator should send mail. Structured as follows:\n\n    protocol://user:pass@hostname:port/domain/sender\n\t\t\n* `protocol`: normally \"smtp\", can be \"smtps\"\n* `user`: the user with which to login to the SMTP server, if authentication is required.\n* `pass`: the password with which to login to the SMTP server, if authentication is required.\n* `hostname`: the hostname of the server, e.g. \"smtp.gmail.com\".\n* `port`: the port to use.\n* `domain`: the domain from which the mail is sent, when the mail server is first connected to.\n* `sender`: the email to use as the sender or \"from\" of the emails sent. Can be in the format `name@domain.com` or `My Name <name@domain.com>`. Should always be URL-encoded (or else you'll never get it into a URL!)\n\n##### templates\nThe directory where you keep text files that serve as mail templates. See below under the section templates.\n\n\n### Activation\nActivation is the two-step process wherein a user first *creates* their account and *then* confirms (or activates) it by clicking on a link in an email or entering a short code via SMS/iMessage/etc.\n\nactivator provides the route handlers to create the activation code on the account and send the email, and then confirm the entered code to mark the user activated.\n\nactivator does **not** create the user; it leaves that up to you, since everyone likes to do it just a little differently.\n\n\n#### Create an activation\nActivation is simple, just add the route handler *after* you have created the user:\n\n````JavaScript\napp.post(\"/users\",createUser,activator.createActivate);\n````\n\n`activator.createActivate` needs access to several pieces of data in order to do its job:\n\n* `id`: It needs the ID of the user, so that it can call `user.save(id,data)`\n* `response.body`: Since `createUser` (in the above example) or anything you have done to create a user might actually want to send data back, `createActivate()` needs to be able to know what the body you want to send is, when it is successful and calls `res.send(201,data);`\n\n`createActivate()` will look for these properties on `req.activator`. \n\n````JavaScript\nreq.activator = {\n\tid: \"12345tg\", // the user ID to pass to createActivate()\n\tbody: \"A message\" // the body to send back along with the successful 201\n}\n````\n\nIf `createActivate()` cannot find `req.activator.id` or `req.user.id`, it will send a `500` error.\n\nWhen done, activator will send a `201` response code and a response body as passed in `req.activator.body`.\n\n#### Complete an activation\nOnce the user actually clicks on the link, you need to complete the activation:\n\n````JavaScript\napp.put(\"/users/:user/activation\",activator.completeActivate);\n````\n\nactivator will return a `200` if successful, a `400` if there is an error, along with error information, and a `404` if it cannot find that user.\n\nactivator assumes the following:\n\n1. The express parameter `user` (i.e. `/users/:user/whatever/foo`) contains the user identifier to pass to `user.find()` as the first parameter. It will retrieve it using `req.param('user')`\n2. The `req.body` or `req.query` will contain the parameter `code` which has the actual activation code. It will retrieve it using `req.param('code')`\n\nIf it is successful activating, it will return `200`, a `400` if there is an error (including invalid activation code), and a `404` if the user cannot be found.\n\n### Password Reset\nPassword reset is a two-step process in which the user requests a password reset link, normally delivered by email, and then uses that link to set a new password. Essentially, the user requests a time-limited one-time code that is delivered to the user and allows them to set a new password.\n\n#### Create a password reset\nCreating a password reset is simple, just add the route handler:\n\n````JavaScript\napp.post(\"/passwordreset\",activator.createPasswordReset);\n````\n\nWhen done, activator will send a `201` response code and a response body whose text content is the URL to be used to reset the password.\n\nActivator assumes that the login/email/ID to search for will be in `req.param(\"user\")`.\n\n#### Complete a password reset\nOnce the user actually clicks on the link, you need to complete the password reset:\n\n````JavaScript\napp.put(\"/users/:user/passwordreset\",activator.completePasswordReset);\n````\n\nactivator will return a `200` if successful, a `400` if there is an error, along with error information, and a `404` if it cannot find that user.\n\nactivator assumes the following:\n\n1. The express parameter `user` (i.e. `/users/:user/whatever/foo`) contains the user identifier to pass to `user.find()` as the first parameter. It will retrieve it using `req.param('user')`\n2. The `req.body` or `req.query` will contain the parameter `code` which has the actual password reset code, and the parameter `password` which is the new password to set. It will retrieve them using `req.param('code')` and `req.param('password')`.\n\nIf it is successful resetting the password, it will return `200`, a `400` if there is an error (including invalid code), and a `404` if the user cannot be found.\n\n\n### Templates\nIn order to send an email (yes, we are thinking about SMS for the future). activator needs to have templates. The templates are simple text files that contain the text or HTML to send.\n\nThe templates should be in the directory passed to `activator.init()` as the option `templates`. It **must** be an absolute directory path (how else is activator going to know, relative to what??). Each template file should be named according to its function: \"activate\" or \"passwordreset\". You can, optionally, add \".txt\" to the end of the filename, if it makes your life easier.\n\nEach template file must have 3 or more lines. The first line is the `Subject` of the email; the second is ignored (I like to use '-----', but whatever works for you), the third and all other lines are the content of the email.\n\nRemember, activator is a *server-side* product, so it really has no clue if the page the user should go to is https://myserver.com/funny/page/activate/fooooo.html or something a little more sane like https://myserver.com/activate.html\n\nHow does activator know what to put in the email? **It doesn't; you do!**. You put the URL in the template files for passwordreset and activate. \n\nWhat you can do is have activator embed the necessary information into the templates before sending the email. Each template file follows a simplified [EJS](http://embeddedjs.com) style (very similar to PHP). All you need to do is embed the following anywhere (and as many times as you want) inside the template:\n\n    <%= abc %>\n\t\t\nand every such instance will be replaced by the value of `abc`. So if `abc = \"John\"`, then \n\n    This is an email for <%= abc %>, \n\t\t   hi there <%= abc %>.\n\nWill be turned into\n\n    This is an email for John,\n\t\t   hi there John.\n\t\t\t \nSo what variables are available inside the templates?\n\n* `code`: the activation or password reset code\n* `email`: the email of the recipient user\n* `id`: the internal user ID of the user\n* `request`: the `request` object that was passed to the route handler, from which you can extract lots of headers, for example the protocol at `req.protocol` or the hostname from `req.headers.host`. \n\nSo if your password reset page is on the same host and protocol as the request that came in but at \"/reset/my/password\", and you want to include the code in the URL as part of a query but also add it to the page, you could do:\n\n\n    Hello,\n\t\t\n\t\tYou have asked to reset your password for MySite. To reset your password, please click on the following link:\n\t\t\n\t\t<%= request.protocol %><%= req.headers.host %>/reset/my/password?code=<%= code %>&user=<%= id %>\n\t\t\n\t\tOr just copy and paste that link and enter your code as <%= code %>.\n\t\t\n\t\tThanks! \n\t\tFrom: the MySite team\n\n\n\n\nInternationalization support is just around the corner...\n\n## Testing\nTo run the tests, from the root directory, run `npm test`.\n\n## License\nReleased under the MIT License. \nCopyright Avi Deitcher https://github.com/deitch\n",
  "readmeFilename": "README.md",
  "bugs": {
    "url": "https://github.com/deitch/activator/issues"
  },
  "_id": "activator@0.2.5",
  "_from": "activator@latest"
}
